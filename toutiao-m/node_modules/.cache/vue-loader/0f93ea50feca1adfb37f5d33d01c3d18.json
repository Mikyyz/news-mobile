{"remainingRequest":"/Users/mikyyz/vue-trip/toutiao-m/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mikyyz/vue-trip/toutiao-m/src/views/login/index.vue?vue&type=style&index=0&id=37dfd6fc&lang=less&scoped=true&","dependencies":[{"path":"/Users/mikyyz/vue-trip/toutiao-m/src/views/login/index.vue","mtime":1601834783802},{"path":"/Users/mikyyz/vue-trip/toutiao-m/node_modules/css-loader/dist/cjs.js","mtime":1599750699944},{"path":"/Users/mikyyz/vue-trip/toutiao-m/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1599750700770},{"path":"/Users/mikyyz/vue-trip/toutiao-m/node_modules/postcss-loader/src/index.js","mtime":1554731891704},{"path":"/Users/mikyyz/vue-trip/toutiao-m/node_modules/less-loader/dist/cjs.js","mtime":1566487728822},{"path":"/Users/mikyyz/vue-trip/toutiao-m/node_modules/cache-loader/dist/cjs.js","mtime":1599750694245},{"path":"/Users/mikyyz/vue-trip/toutiao-m/node_modules/vue-loader/lib/index.js","mtime":1599750700770}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmxvZ2luLWhlYWRlciwgLmxvZ2luLWZvcm0gewogICAgbWFyZ2luOiA0MHB4IDMwcHg7Cn0KLmxvZ2luX2ltZyB7CiAgICB3aWR0aDogMzBweDsKICAgIGhlaWdodDogMzBweDsKfQoubG9naW4tdGVybXMubG9naW5fY29udHJhY3QgewogICAgbWFyZ2luOiAyMHB4IDA7CiAgICBmb250LXNpemU6IDEycHg7Cn0KLmxvZ2luX3RpdGxlIHsKICAgIGZvbnQtc2l6ZTogMjZweDsKICAgIGxldHRlci1zcGFjaW5nOiAycHg7CiAgICBjb2xvcjogIzIzMjMyMzsKfQoubG9naW5fY29udHJhY3QgewogICAgZm9udC1zaXplOiAxNHB4OwogICAgY29sb3I6ICM5NTk1OTU7Cn0KLnVzZXJfYWdyZWVtZW50LCAucHJpdmFjeV9wb2xpY3kgewogICAgY29sb3I6ICM2NzY3Njc7CiAgICBjdXJzb3I6IHBvaW50ZXI7Cn0KLmNvdW50LWRvd24gewogICAgY29sb3I6ICM2NzY3Njc7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/login","sourcesContent":["<template>\n    <div class=\"login\">\n        <van-nav-bar\n            right-text=\"遇到问题\"\n            left-arrow\n            @click-right=\"$router.push({name: 'login-question'})\"\n            @click-left=\"$router.back()\"\n        />\n        <div class=\"login-header\">\n             <van-row type=\"flex\" align=\"center\">\n                <van-col span=\"3\">\n                    <img src=\"http://sf3-dycdn-tos.pstatp.com/obj/eden-cn/uhbfnupkbps/toutiao_favicon.ico\" class=\"login_img\" alt=\"\">\n                </van-col>\n                <van-col>\n                    <span class=\"login_title\">手机登录</span>\n                </van-col>\n            </van-row>\n            <van-row>\n                <van-col class=\"login_contract\">\n                    登录即表示同意\n                    <router-link class=\"user_agreement\" to=\"/user_agreement\">\"用户协议\"</router-link>\n                    和\n                    <router-link class=\"privacy_policy\" to=\"/privacy_protection\">\"隐私政策\"</router-link>\n                </van-col>\n            </van-row>\n        </div>\n        <div class=\"login-form\">\n            <van-form \n            :show-error=\"false\" \n            :show-error-message=\"false\" \n            validate-first\n            ref=\"login-form\"\n            @submit=\"onLogin\"\n            @failed=\"onLoginFailed\">\n                <van-field\n                    v-model=\"user.mobile\"\n                    placeholder=\"请输入手机号\"\n                    :rules=\"formRules.mobile\"\n                    name=\"mobile\"\n                />\n                <van-field\n                    v-model=\"user.code\"\n                    placeholder=\"请输入6位验证码\"\n                    :rules=\"formRules.code\"\n                    name=\"vode\"\n                >\n                    <template #button>\n                        <van-count-down v-if=\"isCountdownShow\" :time=\"time\" @finish=\"countDownFinished\" class=\"count-down\" format=\"ss 秒后重新获取\" />\n                        <van-button v-else size=\"small\" type=\"info\" :disabled=\"isButtonDisabled\" @click.prevent=\"onSendSms\">发送验证码</van-button>\n                    </template>\n                </van-field>\n                <div class=\"login-terms login_contract\">\n                    未注册的手机号验证通过后将自动注册\n                </div>\n                <div class=\"login-btn\">\n                    <van-button type=\"info\" block>登录</van-button>\n                </div>\n            </van-form>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { login, sendSms } from '@/api/user';\n    export default {\n        name: 'login',\n        data() {\n            return {\n                time: 1000 * 60,\n                isCountdownShow: false,\n                isButtonDisabled: false,\n                user: {\n                    mobile: '',\n                    code: ''\n                },\n                formRules: {\n                    mobile: [\n                        { required: true, message: '请输入手机号' },\n                        { pattern: /^1[34578]\\d{9}$/, message: '手机号格式错误' }\n                    ],\n                    code: [\n                        { required: true, message: '请输入6位验证码' },\n                        { pattern: /^\\d{6}$/, message: '验证码为6位数字' }\n                    ]\n                }\n            }\n        },\n        methods: {\n           async onLogin() {\n\n               this.$toast.loading({\n                   message: '登录中...',\n                   forbidClick: true,\n                   duration: 0\n               })\n\n               try {\n                   const { data } = await login(this.user);\n                   //console.log(res);\n                   this.$toast.success('登录成功')\n                   //登录成功之后将后端返回的token存储到VUEX中\n                   this.$store.commit('setUser', data.data)\n                   \n                   //登录成功后跳转到之前的页面\n                   this.$router\n               } catch (err) {\n                   this.$toast.fail('登录失败')\n               }\n           },\n           onLoginFailed (errorInfo) {\n               if(errorInfo.errors[0]) {\n                   this.$toast({\n                       message: errorInfo.errors[0].message,\n                       position: 'top'\n                   })\n               }\n           },\n           async onSendSms() {\n               try {\n                   //校验手机号码\n                   await this.$refs['login-form'].validate('mobile');\n                   //校验通过请求发送验证码\n                   this.isButtonDisabled = true;\n                   const res = await sendSms(this.user.mobile);\n                   console.log(res);\n                   //短信发出去了，隐藏发送按钮，显示倒计时\n                   if(res.status === 200) {\n                       this.isCountdownShow = true;\n                   }\n               } catch (err) {\n                   this.$toast({\n                       message: err.message,\n                       position: 'top'\n                   })\n               }\n               //无论验证码发送成功还是失败都要设置按钮的disabled属性为false\n               this.isButtonDisabled = false;\n           },\n           countDownFinished() {\n               //倒计时完成后隐藏\n               this.isCountdownShow = false;\n           }\n        },\n    }\n</script>\n\n<style lang=\"less\" scoped>\n.login-header, .login-form {\n    margin: 40px 30px;\n}\n.login_img {\n    width: 30px;\n    height: 30px;\n}\n.login-terms.login_contract {\n    margin: 20px 0;\n    font-size: 12px;\n}\n.login_title {\n    font-size: 26px;\n    letter-spacing: 2px;\n    color: #232323;\n}\n.login_contract {\n    font-size: 14px;\n    color: #959595;\n}\n.user_agreement, .privacy_policy {\n    color: #676767;\n    cursor: pointer;\n}\n.count-down {\n    color: #676767;\n}\n</style>"]}]}